import asyncio
import re
from aiogram import Bot, Dispatcher, types, F
from aiogram.filters import Command

# –¢–æ–∫–µ–Ω –≤–∞—à–µ–≥–æ –±–æ—Ç–∞ –æ—Ç @BotFather
TOKEN = "–í–ê–®_–¢–û–ö–ï–ù_–ë–û–¢–ê"

bot = Bot(token=TOKEN)
dp = Dispatcher()

# –°–ø–∏—Å–æ–∫ –ø—Ä–∏–∑–Ω–∞–∫–æ–≤ –º–æ—à–µ–Ω–Ω–∏—á–µ—Å—Ç–≤–∞ (–∞–∫—Ç—É–∞–ª—å–Ω–æ –Ω–∞ 2026 –≥–æ–¥)
FRAUD_KEYWORDS = [
    "–±–µ–∑–æ–ø–∞—Å–Ω—ã–π —Å—á–µ—Ç", "—Å–ª—É–∂–±–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏", "–≥–æ—Å—É—Å–ª—É–≥–∏ –ø–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ",
    "–≤—ã–∏–≥—Ä—ã—à", "–∞–∫—Ü–∏—è —Ç–æ–ª—å–∫–æ —Å–µ–≥–æ–¥–Ω—è", "–≤–≤–µ–¥–∏—Ç–µ –∫–æ–¥", "–¥–∏—Å—Ç–∞–Ω—Ü–∏–æ–Ω–Ω—ã–π –∑–∞—Ä–∞–±–æ—Ç–æ–∫",
    "–∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–æ–Ω–Ω–∞—è –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞", "—Å—Ä–æ—á–Ω–æ –ø–µ—Ä–µ–≤–µ–¥–∏—Ç–µ", "–ª–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç –≤–∑–ª–æ–º–∞–Ω"
]

# –†–µ–≥—É–ª—è—Ä–Ω–æ–µ –≤—ã—Ä–∞–∂–µ–Ω–∏–µ –¥–ª—è –ø–æ–∏—Å–∫–∞ –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—ã—Ö —Å—Å—ã–ª–æ–∫ (–∫–æ—Ä–æ—Ç–∫–∏–µ —Å—Å—ã–ª–∫–∏ –∏ IP)
URL_PATTERN = r"(https?://(?:bit\.ly|t\.me|clck\.ru|[\d\.]{7,})[^\s]*)"

async def analyze_text(text: str):
    score = 0
    reasons = []
    
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –∫–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞
    for word in FRAUD_KEYWORDS:
        if word in text.lower():
            score += 1
            reasons.append(f"‚Ä¢ –§—Ä–∞–∑–∞-–º–∞—Ä–∫–µ—Ä: '{word}'")
    
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –∫–æ—Ä–æ—Ç–∫–∏—Ö/–ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—ã—Ö —Å—Å—ã–ª–æ–∫
    links = re.findall(URL_PATTERN, text)
    if links:
        score += 2
        reasons.append(f"‚Ä¢ –ü–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω–∞—è —Å—Å—ã–ª–∫–∞: {links[0]}")

    return score, reasons

@dp.message(Command("start"))
async def cmd_start(message: types.Message):
    await message.answer(
        "üõ° **–ê–Ω—Ç–∏-–ú–æ—à–µ–Ω–Ω–∏–∫ –ë–æ—Ç 2026**\n\n"
        "–ü–µ—Ä–µ—à–ª–∏—Ç–µ –º–Ω–µ –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –∏–ª–∏ —Å—Å—ã–ª–∫—É, –∏ —è –ø—Ä–æ–≤–µ—Ä—é –∏—Ö –Ω–∞ –Ω–∞–ª–∏—á–∏–µ —É–≥—Ä–æ–∑."
    )

@dp.message(F.text)
async def handle_message(message: types.Message):
    score, reasons = await analyze_text(message.text)
    
    if score >= 2:
        response = (
            "üö® **–í–ù–ò–ú–ê–ù–ò–ï: –í–´–°–û–ö–ê–Ø –í–ï–†–û–Ø–¢–ù–û–°–¢–¨ –ú–û–®–ï–ù–ù–ò–ß–ï–°–¢–í–ê!**\n\n"
            "–ü–æ—á–µ–º—É —ç—Ç–æ –æ–ø–∞—Å–Ω–æ:\n" + "\n".join(reasons) +
            "\n\n**–°–æ–≤–µ—Ç:** –ù–µ –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç–µ –ø–æ —Å—Å—ã–ª–∫–∞–º –∏ –Ω–µ —Å–æ–æ–±—â–∞–π—Ç–µ –Ω–∏–∫–∞–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö."
        )
        await message.reply(response, parse_mode="Markdown")
    elif score == 1:
        await message.reply("‚ö†Ô∏è **–ü–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ.** –ë—É–¥—å—Ç–µ –æ—Å—Ç–æ—Ä–æ–∂–Ω—ã, –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É—é—Ç —Ç–∏–ø–∏—á–Ω—ã–µ —Ñ—Ä–∞–∑—ã –º–∞–Ω–∏–ø—É–ª—è—Ç–æ—Ä–æ–≤.")
    else:
        await message.reply("‚úÖ –ü—Ä–∏–∑–Ω–∞–∫–æ–≤ —è–≤–Ω–æ–≥–æ –º–æ—à–µ–Ω–Ω–∏—á–µ—Å—Ç–≤–∞ –Ω–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–æ, –Ω–æ –≤—Å–µ–≥–¥–∞ —Å–æ—Ö—Ä–∞–Ω—è–π—Ç–µ –±–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å.")

async def main():
    print("–ë–æ—Ç –∑–∞–ø—É—â–µ–Ω –∏ –≥–æ—Ç–æ–≤ –∑–∞—â–∏—â–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π!")
    await dp.start_polling(bot)

if __name__ == "__main__":
    try:
        asyncio.run(main())
    except KeyboardInterrupt:
        print("–ë–æ—Ç –≤—ã–∫–ª—é—á–µ–Ω")
